
@using MPC.Webstore.Common;
<div class="container content_area">
    <div class="row left_right_padding">
        <div id="BCTitle" class="signin_heading_div col-md-12 col-lg-12 col-xs-12">
            <label id="lbl_OrderManagement" class="sign_in_heading">@Html.Raw(Html.GetKeyValueFromResourceFile("lblORderManagment", UserCookieManager.StoreId))</label>
        </div>
        <div class="clearboth">
        </div>
        @if (ViewData["rptRetailDashboardItem"] != "")
        {
            <div class="signin_heading_div col-md-12 col-lg-12 col-xs-12">
                <label id="lbl_HeadingTitle" class="sign_in_heading">@Html.Raw(Html.GetKeyValueFromResourceFile("lblHeadingTitle", UserCookieManager.StoreId))</label>
            </div>
            <div id="cntDashboardItems" class="white-container-lightgrey-border rounded_corners">
                <div class="padding50">
                    @foreach (var item in ViewData["rptRetailDashboardItem"] as List<MPC.Webstore.Models.DashboardViewModel>)
                    {
                        if (item.IsChangePassword ?? false)
                        {
                            <a onclick="ChangePassPopupShow();">
                                <div class="col-lg-4 col-md-6 col-sm-6 col-xs-12">
                                    <div class="main-box clearfix profile-box-contact">
                                        <div class="main-box-body clearfix">
                                            <div class="profile-box-header gray-bg clearfix">
                                                @Html.Raw(item.ImageURL)
                                                <h2>@item.Name</h2>
                                                <div class="profile-box-footer clearfix">
                                                    @item.Description
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>

                                </div>

                            </a>
                        }
                        else
                        {
                            <a href="@item.PageNavigateURl">
                                <div class="col-lg-4 col-md-6 col-sm-6 col-xs-12">
                                    <div class="main-box clearfix profile-box-contact">
                                        <div class="main-box-body clearfix">
                                            <div class="profile-box-header gray-bg clearfix">
                                                
                                                <i class="cicon  profile-img">@Html.Raw(item.ImageURL)</i>
                                                @*<img src="@item.ImageURL" class="profile-img img-responsive" />*@
                                                <div id="measurement">
                                                <h6>@item.Name</h6>
                                                <div class="job-position">
                                                  @item.Description
                                               </div>
                                                </div>
                                            </div>
                                            @*<div class="job-position">
                                                @item.Description
                                            </div>*@
                                            @*<div class="job-position">
                                                Actress
                                            </div>*@
                                        </div>
                                    </div>

                                </div>

                            </a>
                        }


                    }
                    <div class="clearBoth">
                        &nbsp;
                    </div>
                </div>
            </div>
            <div class="spacer10pxtop">
                &nbsp;
            </div>
        }


    </div>
    <br />
    <br />
    <br />
</div>
@using (Html.BeginForm())
{
        <div id="ResetPassword" style="display:none;">
            <table id="CurPssCont" class="normalTextStyle tblRestPass">
                <tr>
                    <td>
                        <label id="errorMesg" style="display:none;font-size: 13px;color: red;"></label>
                        <label id="candNewError" style="display:none;font-size: 13px;color: red;"></label>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="float_left_simple smallfonAvenior MarginTopResetPassword">
                            <label id="ltrlPss">Current password:</label>
                        </div>
                        <div class="float_left_simple cnttxtBox marginLeftfotTextbox">
                            @*@Html.TextBoxFor(model => model.CurrentPassword, new { id = "txtCurPass", @class = "newTxtBox", @maxlength="50", @value = "Current Password" }) <br />*@
                            <input type="password" id="txtCurPass" name="txtCurPass" maxlength="50" class="newTxtBox" />
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h3 class="headingsAvenior">New password Details</h3>
                    </td>
                </tr>
                <tr>
                    <td align="right">
                        <div class="float_left_simple smallfonAvenior MarginTopResetPassword">
                            <label id="ltrlnewpass">New Password:</label>
                        </div>
                        <div class="float_left_simple cnttxtBox marginLeftfotTextbox">
                            @*@Html.TextBoxFor(model => model.NewPassword, new { id = "txtNewPassword", @class = "newTxtBox", @maxlength="50", @value = "New Password" }) <br />*@
                            <input type="password" id="txtNewPassword" name="txtNewPassword" maxlength="50" class=" newTxtBox" />
                        </div>
                        <div class="clearBoth">
                            &nbsp;
                        </div>
                    </td>
                </tr>
                <tr>
                    <td align="right" class="H4B">
                        <div class="float_left_simple smallfonAvenior MarginTopResetPassword">
                            <label id="ltrlconfirmpass">Confirm Password:</label>
                        </div>
                        <div class="float_left_simple cnttxtBox marginLeftfotTextbox">
                            @*@Html.TextBoxFor(model => model.NewPassword, new { id = "txtConfirmPassword", @class = "newTxtBox", @maxlength="50", @value = "Confirm Password" }) <br />*@
                            <input type="password" id="txtConfirmPassword" name="txtConfirmPassword" maxlength="50" class="newTxtBox" />
                        </div>
                        <div class="clearBoth">
                            &nbsp;
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div class="float_left_simple smallfonAvenior">
                            &nbsp;
                        </div>
                        <div class="float_left_simple cnttxtBox left_align marginLeftfotTextbox" style="margin-top: 30px;">
                            <input type="submit" onclick="PasswordValidation();" class="start_creating_btn rounded_corners5" value="Save" />
                            @*<asp:Button ID="cmdSave" CssClass="start_creating_btn rounded_corners5" OnClientClick="return Passwordvalidator();"
            runat="server" Text="Save" OnClick="cmdSave_Click" />*@
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    <input type="hidden" ID="hfErrorMes"  Value="@ViewBag.ErrorMes" />
}

@section scripts
{

    <script src="~/Scripts/PopUp.js"></script>

    <script type="text/javascript">

        $(document).ready(function () {

            $("#txtCurPass").focus();

            if ($("#hfErrorMes").val() == "1") {
               
            }
            else if ($("#hfErrorMes").val() == "3") {
                Passwordvalidator();
                $("#hfErrorMes").val(1);
                
            } else {
           
                $("#errorMesg").text("Your current password is not valid.");
                $("#errorMesg").css("display", "block");
                $("#txtCurPass").css("border", "1px solid #b33c12");//.parent().addClass("field-with-errors");
                $("#hfErrorMes").val(1);
                ChangePassPopupShow();
            }
        });



        function ChangePassPopupShow() {
            
            var panelHtml = $("#ResetPassword").html();

            ShowResetPassword('Reset Password', panelHtml)

        }


        function Passwordvalidator() {
            var isValid = true;
            var isDataFilles = 1;
            var CurrentPass = $("#txtCurPass").val();
            var passwordnew = $('#txtNewPassword').val();
           
            var Confirmpassword = $('#txtConfirmPassword').val();
          
            if (CurrentPass.length == 0) {
                isValid = false; isDataFilles = 0;
                //$('.EMCurentPass').css("display", "block");
                $("#txtCurPass").css("border", "1px solid #b33c12");//.parent().addClass("field-with-errors");
            } else {
                //$('.EMCurentPass').css("display", "none");
                $("#txtCurPass").css("border", "1px solid #c1c6cc");//.parent().removeClass("field-with-errors");
            }
            if (passwordnew.length == 0) {
                isValid = false; isDataFilles = 0;
              //  var passwordxreq = "<%= Resources.MyResource.popupPasswordxreq %>";
                //$('.EMPass').css("display", "block");
                $("#txtNewPassword").css("border", "1px solid #b33c12");//.parent().addClass("field-with-errors");

            } else {
                //$('.EMPass').css("display", "none");
                $("#txtNewPassword").css("border", "1px solid #c1c6cc");//.parent().removeClass("field-with-errors");
            }
            if (Confirmpassword.length == 0) {
                //var Cpasswordxreq = "<%= Resources.MyResource.Cpasswordxreq %>";
                //$('.EMCPass').css("display", "block");
                $("#txtConfirmPassword").css("border", "1px solid #b33c12");//.parent().addClass("field-with-errors");

                isValid = false; isDataFilles = 0;
            } else {
                //$('.EMCPass').css("display", "none");
                $("#txtConfirmPassword").css("border", "1px solid #c1c6cc");//.parent().removeClass("field-with-errors");

            }

            if (passwordnew === Confirmpassword) {

            } else {
               
                $("#errorMesg").css("display", "block");
                $("#errorMesg").text("Password not match.");
                $("#txtNewPassword").css("border", "1px solid #b33c12");//.parent().addClass("field-with-errors");

                $("#txtConfirmPassword").css("border", "1px solid #b33c12");//.parent().addClass("field-with-errors");
                isValid = false;
                isDataFilles = 0;
            }

            if (isDataFilles == 0) {
                $("#hfErrorMes").val(3);
            } else {
                $("#hfErrorMes").val(1);
                return true;
            }
            return false;
        }

        function PasswordValidation()
        {
            var CurrentPass = $("#txtCurPass").val();
            var data = { CurrentPassword: CurrentPass }
            $.ajax({
                type: "POST",
                url: "/Dashboard/GetPassWord",
                contentType: "application/json",
                data:JSON.stringify(data),
                async: true,
                success: function (response) {
                   
                    if (PasswordValidationSummary(response) == true)
                    {
                        
                        ResetPassword();
                    }
                }
            });
        }
        function PasswordValidationSummary(Result)
        {
            var IsValid = true;
            $("#errorMesg").css("display", "none");
            var CurrentPass = $("#txtCurPass").val();
            var passwordnew = $('#txtNewPassword').val();
            var Confirmpassword = $('#txtConfirmPassword').val();
            if (CurrentPass.length == 0) {
                IsValid = false;
                $("#txtCurPass").css("border", "1px solid #b33c12");
            } else {
                
               $("#txtCurPass").css("border", "1px solid #c1c6cc");
            }
            if (passwordnew.length == 0) {
                IsValid = false;
               
                $("#txtNewPassword").css("border", "1px solid #b33c12");

            } else {
                
                $("#txtNewPassword").css("border", "1px solid #c1c6cc");
            }
            if (Confirmpassword.length == 0) {
                
                $("#txtConfirmPassword").css("border", "1px solid #b33c12");

                IsValid = false;
            } else {
               
                $("#txtConfirmPassword").css("border", "1px solid #c1c6cc");//.parent().removeClass("field-with-errors");
            }
            if (CurrentPass != "") {
               
                if (Result == false) {
                    $("#errorMesg").css("display", "block");
                    $("#errorMesg").text("Current Password Does Not Match.");
                    IsValid = false;
                    $("#txtCurPass").css("border", "1px solid #b33c12");
                }
                else {
                   // $("#txtCurPass").css("border", "1px solid #b33c12");
                    if (passwordnew != null && Confirmpassword != null) {

                        if (passwordnew != Confirmpassword) {
                            $("#errorMesg").css("display", "block");
                            $("#errorMesg").text("New and Confirm Password Does Not Match");
                            IsValid = false;
                            $("#txtNewPassword").css("border", "1px solid #b33c12");
                            $("#txtConfirmPassword").css("border", "1px solid #b33c12");
                        }
                    }
                }
            }
            return IsValid;
        }

        function ResetPassword()
        {
          //  PasswordValidation();
            var CurrentPass = $("#txtCurPass").val();
            var passwordnew = $('#txtNewPassword').val();
            window.location.href = "/Dashboard/ResetPassword/" + CurrentPass + "/" + passwordnew;
        }
    </script>
}