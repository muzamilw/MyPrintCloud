@model MPC.Models.Common.ShoppingCart
@using MPC.Webstore.Common;
@using MPC.Models.Common;
@{
    double GrossTotal = 0;
    string VatTotal = string.Empty;
    string subtotal = string.Empty;
    var AddressList = ViewData["OrderAddresses"] as List<MPC.Models.DomainModels.Address>;
    string EstimateDispatchTime = string.Empty;
    double _priceTotal = 0;
    double _vatTotal = 0;
    double _grandTotal = 0;
    decimal noOfCostCentreProdDays = 0;
    decimal _numOfProductionDays = 0;
    decimal numberOfDaysAddedTodelivery = 0;
    decimal ProductProductionTime = 0;
    var ThumnbString = "Thumb.png";

}
<div class="container content_area">
    <div class="row left_right_padding">
        @if (ViewBag.Message != "" && ViewBag.Message != null)
        {
            <div  class="rounded_corners col-md-12 col-lg-12 col-xs-12 WarningMessage">
                <label id="ltrlMessge">@ViewBag.Message</label>
            </div>
        }
       

        <div class="contact_us_heading col-md-12 col-lg-12 col-xs-12 ">
            <label>Confirm Your Order</label>

        </div>

        <div class="white-container-lightgrey-border textAlignLeft rounded_corners OrderConfirmationPanel">
            @if (AddressList[2] != null)
            {
                <div class="col-md-4 col-lg-4 col-xs-6 receiptbillingShippingcnt" style="display:none;">
                    <span style="" class="shopReceiptBillToHeading">PickUpAddress :</span><br />
                    <label id="PickupAddressName" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[2].AddressName</label><br />
                    <label id="pickUpAddressLine1" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[2].Address1</label><br />
                    <label id="pickUpAddress2" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[2].Address2</label><br />
                    <label id="pickUpAddressCity" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[2].City</label>
                    @if (AddressList[2].State != null)
                    {
                        <label id="pickUpAddressState" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[2].State.StateName</label>
                    }
                    else
                    {
                        <label id="pickUpAddressState" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@string.Empty</label>
                    }

                    @if (AddressList[2].Country != null)
                    {
                        <label id="pickUPAddressCountry" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[2].Country.CountryName</label><br />
                    }
                    else
                    {
                        <label id="pickUPAddressCountry" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@string.Empty</label><br />
                    }
                    <label id="pickUpAddressZip" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[2].PostCode</label><br />
                    <span>
                        <label style="color: black;">Tel:</label>
                    </span>
                    <label id="pickUpAddressContact" style="color: black;  font-style: normal; font-weight: normal; font-size: 12px;">@AddressList[2].Tel1</label>
                </div>
            }
            @if (AddressList[1] != null)
            {
                <div class="col-md-4 col-lg-4 col-xs-6 receiptbillingShippingcnt">
                    <span id="Span1" style="" class="shopReceiptBillToHeading">Billing Address :</span><br />
                    <label id="AddressName" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[1].AddressName</label><br />
                    <label id="AddressLine" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[1].Address1</label><br />
                    @if (!string.IsNullOrEmpty(AddressList[1].Address2))
                    {
                        <div><label id="Addressline2" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[1].Address2</label></div>
                    }
                    <label id="lblBCity" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[1].City</label>
                    @if (AddressList[1].State != null)
                    {
                        <label id="lblBState" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[1].State.StateName</label>
                    }
                    else
                    {
                        <label id="lblBState" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@string.Empty</label>
                    }
                    @if (AddressList[1].Country != null)
                    {
                        <label id="lblBCountry" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[1].Country.CountryName</label><br />
                    }
                    else
                    {
                        <label id="lblBCountry" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@string.Empty</label><br />
                    }

                    <label id="lblBZipCode" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[1].PostCode</label><br />
                    @if (!string.IsNullOrEmpty(AddressList[1].Tel1))
                    {
                        <span>
                            <label id="lrtlBTel" style="color: black;">Tel:</label>
                        </span>
                        <label id="lblBTel" style="color: black;  font-style: normal; font-weight: normal; font-size: 12px;">@AddressList[1].Tel1</label>
                    }


                </div>
            }
            @if (AddressList[0] != null)
            {
                <div class="col-md-4 col-lg-4 col-xs-6 receiptbillingShippingcnt">
                    <span id="Span2" style="" class="shopReceiptBillToHeading">Shipping Address:</span><br />
                    <label id="ShippingAddressName" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[0].AddressName</label><br />
                    <label id="shippingAddressline1" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[0].Address1</label><br />
                    @if (!string.IsNullOrEmpty(AddressList[0].Address2))
                    {
                        <div>
                            <label id="shippingAddressline2" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[0].Address2</label>
                        </div>
                    }

                    <label id="shippingCity" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[0].City</label>
                    @if (AddressList[0].State != null)
                    {
                        <label id="shippingState" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[0].State.StateName</label>
                    }
                    else
                    {
                        <label id="shippingState" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@string.Empty</label>
                    }
                    @if (AddressList[0].Country != null)
                    {
                        <label id="shippingCountry" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[0].Country.CountryName</label><br />
                    }
                    else
                    {
                        <label id="shippingCountry" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@string.Empty</label><br />
                    }

                    <label id="shippingZipCode" style="color: black;  font-style: normal; font-weight: bold; font-size: 12px;">@AddressList[0].PostCode</label><br />

                    @if (!string.IsNullOrEmpty(AddressList[0].Tel1))
                    {
                        <span>
                            <label id="Literal2" style="color: black;">Tel:</label>
                        </span>
                        <label id="shippingTel" style="color: black;  font-style: normal; font-weight: normal; font-size: 12px;">@AddressList[0].Tel1</label>
                    }

                </div>

            }
            <div class="clearboth">

            </div>
            <div class="check_out_third_div">
                <div class="confirm_order_detail_div">
                    <div style="min-height: 290px">
                        <div id="pnlConfirmOrder">
                            @*<div class="mainHeadingAveniorCheckout" style="clear: both;">
                                <label id="ltrlconfirmurorderdetails">Confirm your order details...</label>
                            </div>
                            <br />*@
                            <table cellspacing="0" cellpadding="15" id="grdViewShopCart" style="width:100%;border-collapse:collapse;">
                                <tbody>
                                    <tr class="gridViewHeaderStyle">
                                        <th align="center" scope="col" class="hidden-xs">&nbsp;</th>
                                        <th align="left" scope="col">Products</th>
                                        <th align="left" scope="col">Quantity</th>
                                        @if (ViewBag.IsShowPrices == true)
                                        {
                                            <th align="right" scope="col">Price</th>
                                        }
                                    </tr>
                                    @{ foreach (var prod in Model.CartItemsList as List<MPC.Models.Common.ProductItem>)
                                     {
                                        <tr class="gridViewRowStyle" valign="top">
                                            <td class="PadTop5 shopCartFirstCol hidden-xs">
                                                <div class="cart_grid_image_container gallery">
                                                    @{
                                         string pdfLinkBtn = string.Empty;
                                         string imgToShowURL = string.Empty;
                                         if (!string.IsNullOrWhiteSpace(prod.Attatchment.FileName))
                                         {
                                             string ext = System.IO.Path.GetExtension(prod.Attatchment.FileName);
                                             if (ext == ".xlsx" || ext == ".xls" || ext == ".csv")
                                             {
                                                 string completeImgPath = Html.GetAppBasePath() + prod.ThumbnailPath;
                                                 pdfLinkBtn = completeImgPath;// ImageDisplayScript(completeImgPath);
                                                 imgToShowURL = completeImgPath;
                                             }
                                             else
                                             {
                                                 string FolderPathOfAttachment = prod.Attatchment.FolderPath;
                                                 if (FolderPathOfAttachment.Contains("Production") == true)
                                                 {
                                                     FolderPathOfAttachment = FolderPathOfAttachment.Replace("Production", "Attachments");
                                                 }
                                                 // from file table
                                                 //  string completeImgPath = ResolveUrl(GetSideThumbnail(FolderPathOfAttachment, model.Attatchment.FileName));

                                                 pdfLinkBtn = "";// completeImgPath;//ImageDisplayScript(completeImgPath);
                                                 imgToShowURL = "/" + FolderPathOfAttachment + "/" + prod.Attatchment.FileName + ThumnbString;// completeImgPath;
                                             }
                                         }
                                         else
                                         {
                                             if (prod.ProductType == (int)ProductType.NonPrintProduct)
                                             {
                                                 string completeImgPath = prod.ThumbnailPath;
                                                 pdfLinkBtn = completeImgPath;// ImageDisplayScript(completeImgPath);
                                                 imgToShowURL = completeImgPath;
                                             }
                                         }
                                                    }
                                                    <a id="lnkPdfFile" href=@pdfLinkBtn><img id="imgToShow" class="image_stretcher" src="@imgToShowURL"></a>
                                                </div>
                                            </td>
                                            <td style="width:29%;">
                                                <span id="lblItemProductName" class="heading_16">@prod.ProductName</span><span id="CopyTxt" class="heading_16" style="color: red !important;"></span>
                                                <br>
                                                <span id="lblProductCategory" class="ItemdetailDesc">( @prod.ProductCategoryName )</span>
                                                <br>
                                                <br>
                                                <span id="lblSlectedStockName" class="ItemdetailDesc">@prod.PaperType</span>
                                                <br>
                                                <br>
                                                @{
                                         string itemAddsOn = string.Empty;
                                         ProductProductionTime = prod.EstimateProductionTime ?? 0;
                                         if (ViewData["selectedItemsAddonsList"] != null)
                                         {
                                             List<AddOnCostsCenter> costcenters = Model.ItemsSelectedAddonsList as List<AddOnCostsCenter>;
                                             foreach (AddOnCostsCenter cost in costcenters.Where(addon => addon.ItemID == prod.ItemID))
                                             {
                                                 itemAddsOn = itemAddsOn + cost.AddOnName + ",";
                                                 noOfCostCentreProdDays += cost.EstimateProductionTime;
                                             }
                                         }

                                         ProductProductionTime += noOfCostCentreProdDays;
                                         if (_numOfProductionDays < ProductProductionTime)
                                         {
                                             _numOfProductionDays = ProductProductionTime;
                                         }
                                         numberOfDaysAddedTodelivery = _numOfProductionDays;

                                         DateTime date = Utils.AddBusinessdays(_numOfProductionDays, DateTime.Now);

                                         EstimateDispatchTime = date.ToString("MMMM dd, yyyy");
                                                }

                                                <span id="lblselectedAddOnList" class="ItemdetailDesc">@itemAddsOn</span>
                                                <input type="hidden" id="numberOfDaysAddedTodelivery" name="numberOfDaysAddedTodelivery" value="@numberOfDaysAddedTodelivery">
                                                <br>
                                                <br>
                                            </td>
                                            <td class="PadTop5" align="left" style="width:5%;">
                                                <span id="lblItemQuantity" class="fntQtyPrice" style="font-weight:bold;">@prod.Qty1</span>
                                            </td>
                                            @if (ViewBag.IsShowPrices)
                                            {

                                                string itemPrice = string.Empty;
                                                double vatStateTaxPaid = (prod.Qty1GrossTotal ?? 0) - (prod.Qty1BaseCharge1 ?? 0);
                                                _vatTotal += vatStateTaxPaid;

                                                //2.Set item Price Now

                                                _priceTotal += prod.Qty1BaseCharge1 ?? 0;

                                                itemPrice = Utils.FormatDecimalValueToTwoDecimal((prod.Qty1BaseCharge1 ?? 0).ToString(), ViewBag.Currency);
                                                _grandTotal += prod.Qty1GrossTotal ?? 0;

                                                <td class="PadTop5 priceth" align="right" style="width:20%; padding-right:0px;">
                                                    <span id="lblItemPrice" class="fntQtyPrice" style="font-weight:bold;text-align: right !important;">@itemPrice</span>
                                                </td>
                                            }

                                          
                                        </tr>

                                            subtotal = Utils.FormatDecimalValueToTwoDecimal(_priceTotal.ToString(), ViewBag.Currency);
                                            double TotalTax = _vatTotal + Model.DeliveryTaxValue;
                                            VatTotal = Utils.FormatDecimalValueToTwoDecimal(TotalTax.ToString(), ViewBag.Currency);
                                            GrossTotal = _priceTotal + TotalTax + Model.DeliveryCost;

                                     }

                                    }
                                </tbody>
                            </table>
                            <br />
                            @if (ViewBag.IsShowPrices)
                            {
                                <div id="PnalTotalBox">
                                    <table border="0" cellpadding="3" cellspacing="0" width="100%" class="left_align">
                                        <tr>
                                            <td width="30%">
                                                &nbsp;
                                            </td>
                                            <td width="35%">
                                                &nbsp;
                                            </td>
                                            <td width="20%" align="left" class="fontWeightNormal Fsize13" id="td1">
                                                <span id="spnsubtotal" class="CartFonts colorBlack">Sub Total:</span>
                                            </td>
                                            <td align="right" width="20%">
                                                <label id="lblSubTotal" class="Fsize15 colorBlack"
                                                       >@subtotal</label>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td width="30%" align="left">
                                                    &nbsp;
                                                </td>
                                                <td width="35%">
                                                    &nbsp;
                                                </td>
                                                <td width="20%" align="left" class="fontWeightNormal Fsize13" id="td2">
                                                    <span id="spndelivery" class="CartFonts colorBlack">Delivery:</span>
                                                </td>
                                                <td align="right" width="20%">
                                                    <label id="lblDeliveryCostCenter" class="Fsize15 colorBlack"
                                                           >@Utils.FormatDecimalValueToTwoDecimal(Convert.ToString(Model.DeliveryCost), ViewBag.Currency)</label>
                                                    </td>
                                                </tr>
                                                <tr id="Tr2">
                                                    <td width="30%" align="left"></td>
                                                    <td width="35%"></td>
                                                    <td width="20%" align="left" class="fontWeightNormal Fsize13">
                                                        <span id="lblTaxLabel" class="CartFonts colorBlack">@ViewBag.TaxLabel:</span>
                                                    </td>
                                                    <td align="right" width="20%">
                                                        <label id="lblVatTotal" class="Fsize15 colorBlack" >@VatTotal</label>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td width="30%">
                                                        &nbsp;
                                                    </td>
                                                    <td width="35%">
                                                        &nbsp;
                                                    </td>
                                                    <td width="20%" align="left" class="fontWeightNormal Fsize13" id="td3">
                                                        <span class="CartFonts colorBlack" id="spngrandtotal">Total:</span>
                                                    </td>
                                                    <td align="right" width="20%">
                                                        <label class="CartFonts colorBlack Fsize15" id="lblGrandTotal"
                                                               >@Utils.FormatDecimalValueToTwoDecimal(GrossTotal.ToString(), ViewBag.Currency)</label>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                            }
                           
                                    </div>
                                </div>
                                @using (Html.BeginForm())
                                {
                                    <input type="hidden" id="buttonType" name="buttonType" />
                                    if (UserCookieManager.WEBStoreMode == (int)StoreMode.Corp)
                                    {
                                        if (ViewBag.LoginUser.IsPayByPersonalCreditCard == true)
                                        {
                                            if (ViewBag.LoginUser.canPlaceDirectOrder == true)
                                            {
                                                <div class="pad10">
                                                    <div class="float_right marginLeft directDepositcs">
                                                        <input type="submit" value="Pay Via Direct Deposite " id="btnDirectDeposit" class="start_creating_btn_SApp rounded_corners5" onclick="setButtonType('2'); ShowReceiptLoader();" />
                                                    </div>
                                                </div>
                                                <div class="clearBoth">
                                                </div>
                                            }
                                            <div class="pad10">
                                                <div class="float_right marginLeft">
                                                    <input id="btnPlaceOrderUsingCreditCard" class="start_creating_btn_SApp rounded_corners5" type="submit" value="Pay by Credit Card" onclick="setButtonType('1'); ShowLoader();" />

                                                </div>
                                                <div class="float_right">
                                                    <input type="button" value="BACK TO SHOPPING" id="btnShopCart" class="btn_brown rounded_corners5"
                                                           onclick="BackToShopping('@UserCookieManager.WEBOrderId'); ShowLoader();" />
                                                    @*<a href="/" class="btn_brown rounded_corners5">BACK TO SHOPPING</a>*@
                                                </div>
                                                <div class="clearBoth">
                                                    &nbsp;
                                                </div>
                                            </div>

                                        }
                                        else if ((ViewBag.LoginUser.ContactRoleId == Convert.ToInt32(MPC.Models.Common.Roles.Adminstrator) || ViewBag.LoginUser.ContactRoleId == Convert.ToInt32(MPC.Models.Common.Roles.Manager)) || (ViewBag.LoginUser.ContactRoleId == Convert.ToInt32(MPC.Models.Common.Roles.User) && ViewBag.LoginUser.canUserPlaceOrderWithoutApproval == true))
                                        {
                                            <div class="pad10">
                                                <div class="float_right marginLeft">
                                                    <input id="btnPlaceOrder" class="start_creating_btn_SApp rounded_corners5" type="submit" value="Place Order" onclick="setButtonType('1'); ShowReceiptLoader();" />

                                                </div>
                                                <div class="float_right">
                                                    <input type="button" value="BACK TO SHOPPING" id="btnShopCart" class="btn_brown rounded_corners5"
                                                           onclick="BackToShopping('@UserCookieManager.WEBOrderId');" />
                                                    @*<a href="/" class="btn_brown rounded_corners5">BACK TO SHOPPING</a>*@
                                                </div>
                                                <div class="clearBoth">
                                                    &nbsp;
                                                </div>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="pad10">
                                                <div class="float_right marginLeft">
                                                    <input id="btnPlaceOrder" class="start_creating_btn_SApp rounded_corners5" type="submit" value="Submit for Approval" onclick="setButtonType('1'); ShowReceiptLoader();" />

                                                </div>
                                                <div class="float_right">
                                                    <input type="button" value="BACK TO SHOPPING" id="btnShopCart" class="btn_brown rounded_corners5"
                                                           onclick="BackToShopping('@UserCookieManager.WEBOrderId');" />
                                                    @*  <a href="/" class="btn_brown rounded_corners5">BACK TO SHOPPING</a>*@
                                                </div>
                                                <div class="clearBoth">
                                                    &nbsp;
                                                </div>
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <div class="pad10" style="padding-right: 0px !important;">
                                            <div class="float_right marginLeft">
                                                <input id="btnPlaceOrder" class="start_creating_btn_SApp rounded_corners5" type="submit" value="Place Order" onclick="setButtonType('1'); ShowReceiptLoader();" />

                                            </div>
                                            <div class="float_right">
                                                <input type="button" value="BACK TO SHOPPING" id="btnShopCart" class="btn_brown rounded_corners5"
                                                       onclick="BackToShopping('@UserCookieManager.WEBOrderId'); ShowLoader();" />
                                                @*<a href="/" class="btn_brown rounded_corners5">BACK TO SHOPPING</a>*@
                                            </div>
                                            <div class="clearBoth">
                                                &nbsp;
                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <script>
                function setButtonType(Type) {

                    $("#buttonType").val(Type);
                }
                function BackToShopping(OrderId) {
                    window.location.href = "/ShopCart/" + OrderId;
                }
            </script>